
Victor Figueredo


SELECT APQ.APQ_DTHR, 
       PAC.PAC_REG, 
       PAC.PAC_NOME, 
       PGT.PGT_COD,
       PGT.PGT_TEXTO,
       RPA.RPA_RESPOSTA,
       RPT.RPT_TEXTO       
 
FROM PAC
 
 INNER JOIN APQ
         ON APQ.APQ_QUESTIONADO_N = PAC.PAC_REG
        
        AND APQ.APQ_DTHR >= :Data_inicial AND 
            APQ.APQ_DTHR <  :Data_final
 
 INNER JOIN QST   
         ON APQ.APQ_QST_COD = QST.QST_COD
 
 INNER JOIN PGT
         ON PGT_QST_COD = QST_COD
        
       
 
 INNER JOIN RPA
         ON RPA.RPA_QST_COD = PGT.PGT_QST_COD
        AND RPA.RPA_APQ_COD = APQ.APQ_COD
        AND RPA.RPA_PGT_COD = PGT.PGT_COD
        
 
 LEFT JOIN RPT
         ON RPT.RPT_QST_COD = PGT.PGT_QST_COD        
        AND RPT.RPT_PGT_COD = PGT.PGT_COD
        AND RPT.RPT_MINIMO = RPA.RPA_RESPOSTA
        AND RPT.RPT_MAXIMO = RPA.RPA_RESPOSTA
 
 WHERE  APQ.APQ_QST_COD = 152
		PGT_DEL_LOGICA <> 'S' AND
		PGT_TIPO <> 'O' AND 
		RPA.RPA_RESPOSTA <> 0 AND 
		EXISTS( SELECT 1 FROM RPA B WHERE B.RPA_APQ_COD = RPA.RPA_APQ_COD AND B.RPA_PGT_COD = 1 AND B.RPA_RESPOSTA IN (1,2,3,4,5) ) 
 
 ORDER BY APQ.APQ_DTHR ASC, 
          PAC.PAC_REG ASC,
          PGT.PGT_COD ASC


